<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Görev Ekle</title>
</head>
<body>
    <h1> Hoş Geldin </h1>
    <form id="taskform" method="post">
        <label for="myInput1">Title</label>
        <input type="text" id="myInput1" placeholder="Enter task here" required>
        <br>

        <label for="myInput2">Body</label>
        <input type="text" id="myInput2" placeholder="Enter Body here" required>
        <br>

        <label for="priority">Priority</label>
        <select id="priority">
            <option value="0">Low</option>
            <option value="1" selected>Medium</option>
            <option value="2">High</option>
        </select>
        <br>

        <label for="myInput4">Completed?</label>
        <input type="checkbox" id="myInput4">
        <br>

        <button type="submit" id="myButton">Add Task</button>
    </form>

    <h2>Görevler</h2>
    <ul id="taskList"></ul>

    <script>
        const form = document.getElementById('taskform');

        // 🔹 Tüm görevleri çek ve listele
        async function fetchTasks() {
            try {
                const response = await fetch('https://localhost:7290/api/tasks');
                if (!response.ok) throw new Error(response.statusText);

                const tasks = await response.json();
                const taskList = document.getElementById('taskList');
                taskList.innerHTML = ''; // önce temizle

                tasks.forEach(task => {
                    const li = document.createElement('li');
                    li.textContent = `#${task.id} | ${task.title} | ${task.body} | Completed: ${task.completed} | Priority: ${task.priority} | Created: ${task.createdAt}`;
                    taskList.appendChild(li);
                });
            } catch (err) {
                console.error(err);
                alert('Görevleri alırken bir hata oluştu.');
            }
        }

        // 🔹 Görev ekleme (POST)
        form.addEventListener('submit', async function (event) {
            event.preventDefault();

            const task = {
                title: document.getElementById('myInput1').value,
                body: document.getElementById('myInput2').value,
                completed: document.getElementById('myInput4').checked,
                createdAt: new Date().toISOString(),
                priority: parseInt(document.getElementById('priority').value),
                users: []
            };

            try {
                const response = await fetch('https://localhost:7290/api/Tasks', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(task)
                });

                if (response.ok) {
                    alert('Görev eklendi!');
                    form.reset();
                    fetchTasks(); // ✅ Yeni görev eklenince listeyi güncelle
                } else {
                    alert('Hata: ' + response.statusText);
                }
            } catch (err) {
                console.error(err);
                alert('Bir hata oluştu.');
            }
        });

        // Sayfa yüklendiğinde görevleri getir
        window.addEventListener('load', fetchTasks);
    </script>
</body>
</html>
